(function () {
    'use strict';

    angular.module('revux').directive('currencyFormatter', ['$filter', function ($filter) {

        return {
            restrict: 'A',
            require: 'ngModel',
            link: function (scope, element, attr, ngModel) {

                var formatter = function (num) {
                    var symbol = attr.symbol || '';
                    return $filter('currency')(num, symbol);
                };

                ngModel.$parsers.push(function (str) {
                    return str ? Number(str) : '';

                });
                ngModel.$formatters.push(formatter);

                element.bind('blur', function () {
                    element.val(formatter(ngModel.$modelValue))
                });
                element.bind('focus', function () {
                    element.val(ngModel.$modelValue);
                });
            }
        };
    }])

})();