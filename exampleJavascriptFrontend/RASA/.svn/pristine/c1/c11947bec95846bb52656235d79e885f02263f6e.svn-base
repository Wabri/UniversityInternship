(function () {
    'use strict';

    angular.module('revux').directive('selectionsList', selectionsList);

    /**
     *
     * @returns {{templateUrl: string, restrict: string, controller: controller, controllerAs: string, scope: {hardList: string, api: string, apiToParent: string, promise: string}}}
     */
    function selectionsList() {

        var directive = {
            templateUrl: 'common/directives/selectionsList/selectionsList.html',
            restrict: 'E',
            controller: controller,
            controllerAs: 'ctrl',
            bindToController: true,
            scope: {
                datasource: '=',
                api: '=?'
            }
        };

        return directive;
    }

    /**
     *
     * @param $scope
     */
    function controller($scope, Events) {

        var vm = this;
        vm.remove = remove;

        // parte da qui
        init();

        /**
         * init
         */
        function init() {

            // le API
            if (vm.api) {
                vm.api.removeAll = function() {
                   removeAll()
                } ,
                vm.api.isReady = function () {
                    return true;
                }
            }
        }

        /**
         * remove : toglie ( deseleziona ) un item
         * @param item
         */
        function remove(item) {

            // se c'Ã¨ definita funzione...
            if (vm.api && vm.api.onRemove) {
                item.selected = false;
                vm.api.onRemove(item);

            } else
                item.selected = false;
        };

        function removeAll() {
            angular.forEach(vm.datasource, function(items, key) {
                angular.forEach(items, function(item) {
                    if (item && item.selected)
                        item.selected = false;
                })
            });
        }
    };
}
());
