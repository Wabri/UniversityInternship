'use strict';
angular.module('revux')
    .directive('navbarScroll', function ($timeout,$compile,$window) {
        return {
            restrict: 'A',
            link: function(scope, element, attrs) {

                //element = div.nav-tabs-container

                var navbar=$(element.context.children[0]);  //"ul.nav.nav-tabs-bps"
                element.append($compile(
                  '<div class="nav-tabs-bps-after" ng-click="forceScrollToRight()"><i class="fa fa-chevron-right"></i></div>')(scope));
                var elementAfter=$(element).find(".nav-tabs-bps-after")[0];

                scope.forceScrollToRight=function(){
                  var leftPos = $(navbar[0]).scrollLeft();
                  $(navbar[0]).animate({scrollLeft: leftPos + 200}, 400);
                };

                $timeout(function(){
                    if(navbar[0].scrollWidth- navbar.parent().width()==0){
                      $(elementAfter).addClass('nav-tabs-bps-after--hidden');
                    }
                },100);

                var win = $(angular.element($window));
                win.on('resize',resizeNavbar);
                function resizeNavbar () {
                  setAfter();
                }


                navbar.on('scroll',function(){
                  setAfter();
                });

                scope.$on('$destroy', function() {
                  win.off('resize',resizeNavbar);
                  navbar.off('scroll');
                });

                function setAfter(){
                  if((navbar[0].scrollWidth- navbar.parent().width() )  >= (navbar[0].scrollLeft+10)) {
                      $(elementAfter).removeClass('nav-tabs-bps-after--hidden');

                  }
                  else{
                      $(elementAfter).addClass('nav-tabs-bps-after--hidden');
                  }
                }
            }
        }
    });
