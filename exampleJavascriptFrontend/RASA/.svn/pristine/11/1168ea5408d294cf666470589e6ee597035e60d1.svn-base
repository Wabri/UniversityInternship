(function() {
  'use strict';

  angular.module('revux').directive('bvProgressbar', bvProgressbar);

  function bvProgressbar() {

    var directive = {
      templateUrl: 'common/directives/progressbar/progressbar.directive.html',
      restrict: 'E',
      link: link,
      scope: {
        current:"=",
        total:"=",
        classComplete:"=?",
        classIncomplete:"=?",
        classBackground:"=?",
        progressText:"=?",
        minHeight: "@?"

      }
    };

    return directive;




    function link(scope,element) {

      scope.$watch("current", function (value) {
        setCurrentTotal();
      });
      scope.$watch("total", function (value) {
        setCurrentTotal();
      });


      function setCurrentTotal(){
        var progressElement=element[0].querySelector('#progressbarselector');
        progressElement=angular.element(progressElement);
        var current;
        var percentage=0;
        if(scope.current!=undefined && scope.total){
          current=(scope.current / scope.total);
          percentage=((current>1)?1:current)*100;
        }
        progressElement.css("width", percentage + "%");
        setClasses(progressElement);
      }

      function setClasses(progressElement){
        if((scope.total||0)<=(scope.current||0)){
          progressElement.removeClass(scope.classIncomplete);
          progressElement.addClass(scope.classComplete);
          progressElement.addClass('progress-bar-complete');
        }
        else{
          progressElement.removeClass(scope.classComplete);
          progressElement.addClass(scope.classIncomplete);
          progressElement.removeClass('progress-bar-complete');
        }
      }
      
    }

  }




}());
