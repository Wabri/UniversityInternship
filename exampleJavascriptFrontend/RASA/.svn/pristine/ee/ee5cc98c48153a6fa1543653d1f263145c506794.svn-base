(function () {
    'use strict';

    angular
        .module('revux')
        .factory('StateReload', StateReload);

    /**
     *
     * @param $state
     * @returns {{do: do, on: on, off: off}}
     * @constructor
     */
    function StateReload(StorageService) {

        return {
            save: function (stateToReload, data) {

                var params = {options: {stateToReload: stateToReload}, data: data};

                // salva i dati
                StorageService.set("stateReload", angular.toJson(params));


                return true;
            },
            canReload: function ($state) {

                var params = angular.fromJson(StorageService.get("stateReload"));

                // ci sono le confizioni per riprendere la roba ?
                if ($state && $state.current && $state.current.name && params && params.options && params.options && params.options.stateToReload) {
                    if ($state.current.name === params.options.stateToReload)
                        return params;
                    else
                        return null;
                } else
                    return null;
            },
            delete: function () {
                StorageService.clearAll()
            }
        }
    };

})();